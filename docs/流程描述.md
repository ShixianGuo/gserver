# 网络通信

> ps -eo pid,ppid,sid,tty,pgrp,comm,stat,cmd | grep -E 'bash|PID|gserver'


## 监听端口: Listen

**支持多个端口**

### gsx_open_listening_sockets()内容
```
1 创建socket
2 设置SO_REUSEADDR选项
3 设置该socket为非阻塞
4 绑定服务器地址结构体
5 listen
6 加入监听列表
```


## IO复用: epoll 



### gsx_epoll_init 内容
```
1 创建一个epoll对象
2 创建连接池
3 for遍历所有监听socket，为每个监听socket增加一个 连接池中的连接
3---1 从连接池中获取一个空闲连接对象
3---2 对监听端口的读事件设置处理方法
3---3 往epoll上增加监听事件
```


### gsx_epoll_process_events内容
```
 1 epoll_wait按timer参数等待事件
 2 for遍历本次epoll_wait返回的所有事件events
 2---1 过滤过期事件；
 2---2 处理读事件： 新连接：   gsx_event_accept 
                   已经连入：  ngx_wait_request_handler
 2---3 处理写事件：
 
```
### ngx_event_accept：
```

```





